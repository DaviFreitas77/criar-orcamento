<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Criar Orçamento</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            padding: 30px;
            color: #333;
        }

        .header {
            margin-bottom: 20px;
            padding: 15px 20px;
            border-left: 5px solid #007BFF;
            background-color: #f0f8ff;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .header h2 {
            margin: 0 0 8px 0;
            font-weight: 600;
            color: #0D47A1;
        }

        .header p {
            margin: 3px 0;
            font-size: 14px;
            color: #444;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .buttons {
            margin-bottom: 20px;
        }

        .buttons button {
            margin-right: 10px;
            padding: 10px 18px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }

        .buttons button:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: left;
        }

        th {
            background-color: #f1f1f1;
        }

        th#tittle-colunm:nth-child(3) {
            background-color: #ffeb3b;
        }

        #table-total {
            max-width: 400px;
            background-color: #fff;
        }

        #total-value {
            font-weight: bold;
            color: #0D47A1;
            font-size: 18px;
        }
    </style>
</head>

<body>

    <div class="header">
        <h2>Paulino Empreiteira</h2>
        <p>Email: paulino.empreiteira@gmail.com</p>
        <p>Contato: (11) 99999-9999</p>
    </div>

    <div class="buttons">
        <button id="btn-add-colunm">Adicionar Coluna</button>
        <button id="btn-add-row">Adicionar Linha</button>
        <button id="export-pdf">Exportar para PDF</button>
    </div>

    <h1>Criar Orçamento</h1>

    <table id="table">
        <thead>
            <tr>
                <th id="tittle-colunm">Material</th>
                <th id="tittle-colunm">Quantidade</th>
                <th id="tittle-colunm">SubTotal</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Total do Orçamento</h2>
    <table id="table-total">
        <thead>
            <tr>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="total-value">R$ 0,00</td>
            </tr>
        </tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <script>
        const addColunmButton = document.querySelector('#btn-add-colunm');
        const addRowButton = document.querySelector('#btn-add-row');
        const exportPdfButton = document.querySelector('#export-pdf');
        const table = document.querySelector('#table');
        const tableHead = document.querySelector('#table thead');
        const tr = tableHead.querySelector('tr');
        const tableBody = document.querySelector('#table tbody');

        addColunmButton.addEventListener('click', () => {
            const ths = tr.querySelectorAll('th');
            ths.forEach((th, index) => {
                if (th.textContent.toLowerCase() === 'subtotal') {
                    const newth = document.createElement('th')
                    const texTH = prompt('Digite o nome da nova coluna:');
                    if (texTH === '') {
                        alert('Digite um nome para a nova coluna');
                        return;
                    }
                    newth.textContent = texTH;
                    th.parentNode.insertBefore(newth, th);
                    const rows = tableBody.querySelectorAll('tr');
                    if (rows.length === 0) {
                        alert('Não há linhas na tabela para adicionar a nova coluna.');
                        return;
                    }
                    rows.forEach(row => {
                        const newTd = document.createElement('td');
                        const text = prompt(`Digite o valor da nova coluna ${texTH}`);
                        newTd.textContent = text;
                        row.insertBefore(newTd, row.children[index]);
                    });
                }
            });
        });

        addRowButton.addEventListener('click', () => {
            const newRow = document.createElement('tr');
            const ths = tr.querySelectorAll('th');
            ths.forEach(th => {
                const newTd = document.createElement('td');
                let text = prompt(`Digite o valor para ${th.textContent}`);
                if (th.textContent.toLowerCase() === 'subtotal') {
                    let valorNum = parseFloat(text.replace(',', '.'));
                    if (isNaN(valorNum)) {
                        newTd.textContent = '-';
                    } else {
                        newTd.textContent = valorNum.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                    }
                } else {
                    newTd.textContent = text;
                }
                newRow.appendChild(newTd);
            });
            tableBody.appendChild(newRow);
            atualizarTotal();
        });

        function atualizarTotal() {
            let total = 0;
            const rows = tableBody.querySelectorAll('tr');
            const ths = tr.querySelectorAll('th');
            let subtotalIndex = -1;
            ths.forEach((th, i) => {
                if (th.textContent.toLowerCase() === 'subtotal') {
                    subtotalIndex = i;
                }
            });
            if (subtotalIndex === -1) return;
            rows.forEach(row => {
                const tds = row.querySelectorAll('td');
                if (tds.length > subtotalIndex) {
                    let valorStr = tds[subtotalIndex].textContent;
                    valorStr = valorStr.replace(/[R$\s\.]/g, '').replace(',', '.');
                    const valorNum = parseFloat(valorStr);
                    if (!isNaN(valorNum)) {
                        total += valorNum;
                    }
                }
            });
            const totalValueTd = document.querySelector('#total-value');
            totalValueTd.textContent = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        exportPdfButton.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Cabeçalho personalizado
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.setTextColor(13, 71, 161);
            doc.text("Paulino Empreiteira", 14, 18);

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            doc.setTextColor(50, 50, 50);
            doc.text("Email: paulino.empreiteira@gmail.com", 14, 26);
            doc.text("Contato: (11) 99999-9999", 14, 32);

            // Tabela de orçamento
            doc.autoTable({
                html: '#table',
                startY: 40,
                theme: 'grid',
                styles: { fontSize: 10 },
                headStyles: {
                    fillColor: [220, 220, 220],
                    textColor: 0,
                    fontStyle: 'bold'
                },
                didParseCell: function (data) {
                    if (
                        data.section === 'head' &&
                        data.cell.raw &&
                        data.cell.raw.textContent.toLowerCase() === 'subtotal'
                    ) {
                        data.cell.styles.fillColor = [255, 255, 0];
                        data.cell.styles.textColor = [0, 0, 0];
                    }
                }
            });

            const finalY = doc.lastAutoTable.finalY + 10;

            // Total do orçamento destacado
            const totalValue = document.querySelector('#total-value').textContent;
            doc.setFontSize(12);
            doc.setTextColor(0);
            doc.text('Total do Orçamento:', 14, finalY);

         
            doc.setFontSize(14);
            doc.setTextColor(13, 71, 161);
            doc.text(totalValue, 60, finalY + 1);

            doc.save('orcamento.pdf');
        });
    </script>
</body>

</html>